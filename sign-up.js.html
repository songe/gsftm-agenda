<script type="text/babel">
var fields = {
  "word": {
    "pronunciation": "",
    "class": "",
    "definition":"",
    "usage":""
  },
  "roles": {
    "toastmaster": "",
    "speaker1": {
      "speakerName": "",
      "projectNumber": "",
      "projectName": "",
      "speechName": ""
    },
    "speaker2": {
      "speakerName": "",
      "projectNumber": "",
      "projectName": "",
      "speechName": ""
    },
    "genEvaluator":"",
    "genEvaluator": "",
    "evaluator1": "",
    "evaluator2": "",
    "grammarian": "",
    "topicsmaster": "",
    "timer": "",
  }
};

class Field extends React.Component {
  constructor(props) {
    super(props);
    this.state = {saved: ""};
    this.save = this.save.bind(this);
    this.onChange = this.onChange.bind(this);
  }
  save(e) {
    var newValue = e.target.value;
    var update = {};
    update[this.props.name] = newValue;
    this.props.onSave(update);
    this.setState({saved: "‚úÖ"});
  }
  onChange(e) {
    var newValue = e.target.value;
    var update = {};
    update[this.props.name] = newValue;
    this.props.onChange(update);
    this.setState({saved: "üí¨Ô∏è"});
  }
  render() {
    return <label className="field">
      {this.props.name}
      <input type="text" onChange={this.onChange} onBlur={this.save} value={this.props.value} />
      {this.state.saved}
    </label>
  }
}

class Fields extends React.Component {
  render() {
    const data = this.props.data;
    const fields = Object.keys(data).map((name) =>
      <Field
        key={name}
        onChange={this.props.onChange}
        onSave={this.props.onSave}
        name={name}
        value={data[name]}
      />);
    return <dl>
      {fields}
    </dl>;
  }
}

class SignUpForm extends React.Component {
  constructor(props) {
    super(props);
    this.state = this.props.data;
    this.update = this.update.bind(this);
    this.save = this.save.bind(this);
    this.reset = this.reset.bind(this);
  }
  save(data) {
    this.setState(data, function() {
      console.log(`data: ${JSON.stringify(data)}`);
      //FIXME sendUpdatedDataToSheet(this.state);
    });
  }
  update(change) {
    this.setState(change);
  }
  reset() {
    var self = this;
    Object.keys(this.state).forEach((key) => self.state[key] = "");
    this.setState(this.state);
    //FIXME resetEverything();
  }
  render() {
    return <React.Fragment>
      <dt><b>Meeting Date</b></dt><dd>{meetingDate}</dd>
      <button onClick={this.reset}>Clear everything ‚ôªÔ∏èÔ∏è</button>
      <Fields data={this.state} onChange={this.update} onSave={this.save} />
    </React.Fragment>;
  }
}

const element = <SignUpForm data={dataFromSheet}/>;
ReactDOM.render(element, document.getElementById('sign-up'))
</script>